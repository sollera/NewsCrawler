<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.news.mapper.newsMapper">
	
	<!-- 뉴스 기사들 뷰 페이지에 필요한 sql들 -->
	
	<!-- 기사 조회 -->
	<select id="newsList" resultType="newsVO" parameterType="hashmap">
		SELECT * FROM news WHERE enrollDT LIKE CONCAT(#{today},'%') ORDER BY enrollDT desc LIMIT #{firstNews},20;
	</select>
	
	<!-- 전체 기사 숫자 세기(페이징) -->
	<select id="newsCnt" resultType="java.lang.Integer" parameterType="java.lang.String">
		SELECT count(title) FROM news WHERE enrollDT LIKE CONCAT(#{today},'%'); 
	</select>
	
	<!-- NewsPage : 신문사 별 기사 수 -->
	<select id="cntPerSite" resultType="cntVO" parameterType="java.lang.String">
		SELECT site col,count(title) cnt FROM news WHERE enrollDT LIKE CONCAT(#{today},'%') GROUP BY col ORDER BY cnt DESC;
	</select>
	<!-- NewsPage : 카테고리 별 기사 수 -->
	<select id="cntPerType" resultType="cntVO" parameterType="java.lang.String">
		SELECT type col,count(title) cnt FROM news WHERE enrollDT LIKE CONCAT(#{today},'%') GROUP BY col ORDER BY cnt DESC;
	</select>
	
	<!-- 필터O,검색X 기사 조회 -->
	<select id="specificNews1" resultType="newsVO" parameterType="hashmap">
		SELECT * FROM news WHERE enrollDT LIKE CONCAT(#{today},'%') and site in(#{site}) ORDER BY enrollDT desc LIMIT #{firstNews},20;
	</select>
	<select id="specificNews2" resultType="newsVO" parameterType="hashmap">
		SELECT * FROM news WHERE enrollDT LIKE CONCAT(#{today},'%') and type in(#{type}) ORDER BY enrollDT desc LIMIT #{firstNews},20;
	</select>
	<select id="specificNews3" resultType="newsVO" parameterType="hashmap">
		SELECT * FROM news WHERE enrollDT LIKE CONCAT(#{today},'%') and site in(#{site}) and type in(#{type}) ORDER BY enrollDT desc LIMIT #{firstNews},20;
	</select>
	<select id="specificNews4" resultType="newsVO" parameterType="hashmap">
		SELECT * FROM news WHERE enrollDT LIKE CONCAT(#{today},'%') and (type in(#{type}) or type not in('정치','경제','사회','문화','오피니언','스포츠','연예','스포츠ㆍ연예')) ORDER BY enrollDT desc LIMIT #{firstNews},20;
	</select>
	<select id="specificNews5" resultType="newsVO" parameterType="hashmap">
		SELECT * FROM news WHERE enrollDT LIKE CONCAT(#{today},'%') and site in(#{site}) and (type in(#{type}) or type not in('정치','경제','사회','문화','오피니언','스포츠','연예','스포츠ㆍ연예')) ORDER BY enrollDT desc LIMIT #{firstNews},20;
	</select>
	<!-- 필터O,검색X 전체 기사 수 -->
	<select id="newsCnt1" resultType="java.lang.Integer" parameterType="hashmap">
		SELECT count(title) FROM news WHERE enrollDT LIKE CONCAT(#{today},'%') and site in(#{site}); 
	</select>
	<select id="newsCnt2" resultType="java.lang.Integer" parameterType="hashmap">
		SELECT count(title) FROM news WHERE enrollDT LIKE CONCAT(#{today},'%') and type in(#{type}); 
	</select>
	<select id="newsCnt3" resultType="java.lang.Integer" parameterType="hashmap">
		SELECT count(title) FROM news WHERE enrollDT LIKE CONCAT(#{today},'%') and site in(#{site}) and type in(#{type}); 
	</select>
	<select id="newsCnt4" resultType="java.lang.Integer" parameterType="hashmap">
		SELECT count(title) FROM news WHERE enrollDT LIKE CONCAT(#{today},'%') and (type in(#{type}) or type not in('정치','경제','사회','문화','오피니언','스포츠','연예','스포츠ㆍ연예')); 
	</select>
	<select id="newsCnt5" resultType="java.lang.Integer" parameterType="hashmap">
		SELECT count(title) FROM news WHERE enrollDT LIKE CONCAT(#{today},'%') and site in(#{site}) and (type in(#{type}) or type not in('정치','경제','사회','문화','오피니언','스포츠','연예','스포츠ㆍ연예')); 
	</select>
	
	<!-- 필터X,검색O 기사 조회 -->
	<select id="searchNews" resultType="newsVO" parameterType="hashmap">
		SELECT * FROM news WHERE enrollDT LIKE CONCAT(#{today},'%') and title REGEXP #{titleSearch} ORDER BY enrollDT desc LIMIT #{firstNews},20;
	</select>
	<!-- 필터X,검색O 전체 기사 수 -->
	<select id="searchCnt" resultType="java.lang.Integer" parameterType="hashmap">
		SELECT count(title) FROM news WHERE enrollDT LIKE CONCAT(#{today},'%') and title REGEXP #{titleSearch};
	</select>
	
	<!-- 필터O,검색O 기사 조회 -->
	<select id="allConditionNews1" resultType="newsVO" parameterType="hashmap">
		SELECT * FROM news WHERE enrollDT LIKE CONCAT(#{today},'%') and site in(#{site}) and title REGEXP #{titleSearch} ORDER BY enrollDT desc LIMIT #{firstNews},20;
	</select>
	<select id="allConditionNews2" resultType="newsVO" parameterType="hashmap">
		SELECT * FROM news WHERE enrollDT LIKE CONCAT(#{today},'%') and type in(#{type}) and title REGEXP #{titleSearch} ORDER BY enrollDT desc LIMIT #{firstNews},20;
	</select>
	<select id="allConditionNews3" resultType="newsVO" parameterType="hashmap">
		SELECT * FROM news WHERE enrollDT LIKE CONCAT(#{today},'%') and site in(#{site}) and type in(#{type}) and title REGEXP #{titleSearch} ORDER BY enrollDT desc LIMIT #{firstNews},20;
	</select>
	<select id="allConditionNews4" resultType="newsVO" parameterType="hashmap">
		SELECT * FROM news WHERE enrollDT LIKE CONCAT(#{today},'%') and (type in(#{type}) or type not in('정치','경제','사회','문화','오피니언','스포츠','연예','스포츠ㆍ연예')) and title REGEXP #{titleSearch} ORDER BY enrollDT desc LIMIT #{firstNews},20;
	</select>
	<select id="allConditionNews5" resultType="newsVO" parameterType="hashmap">
		SELECT * FROM news WHERE enrollDT LIKE CONCAT(#{today},'%') and site in(#{site}) and (type in(#{type}) or type not in('정치','경제','사회','문화','오피니언','스포츠','연예','스포츠ㆍ연예')) and title REGEXP #{titleSearch} ORDER BY enrollDT desc LIMIT #{firstNews},20;
	</select>
	<!-- 필터O,검색O 전체 기사 수 -->
	<select id="allConditionCnt1" resultType="java.lang.Integer" parameterType="hashmap">
		SELECT count(title) FROM news WHERE enrollDT LIKE CONCAT(#{today},'%') and site in(#{site}) and title REGEXP #{titleSearch}; 
	</select>
	<select id="allConditionCnt2" resultType="java.lang.Integer" parameterType="hashmap">
		SELECT count(title) FROM news WHERE enrollDT LIKE CONCAT(#{today},'%') and type in(#{type}) and title REGEXP #{titleSearch}; 
	</select>
	<select id="allConditionCnt3" resultType="java.lang.Integer" parameterType="hashmap">
		SELECT count(title) FROM news WHERE enrollDT LIKE CONCAT(#{today},'%') and site in(#{site}) and type in(#{type}) and title REGEXP #{titleSearch}; 
	</select>
	<select id="allConditionCnt4" resultType="java.lang.Integer" parameterType="hashmap">
		SELECT count(title) FROM news WHERE enrollDT LIKE CONCAT(#{today},'%') and (type in(#{type}) or type not in('정치','경제','사회','문화','오피니언','스포츠','연예','스포츠ㆍ연예')) and title REGEXP #{titleSearch}; 
	</select>
	<select id="allConditionCnt5" resultType="java.lang.Integer" parameterType="hashmap">
		SELECT count(title) FROM news WHERE enrollDT LIKE CONCAT(#{today},'%') and site in(#{site}) and (type in(#{type}) or type not in('정치','경제','사회','문화','오피니언','스포츠','연예','스포츠ㆍ연예')) and title REGEXP #{titleSearch}; 
	</select>
	
	
	
	
	<!-- 크롤러 관리 페이지 instant -->
	
	<!-- 크롤러 작동 체크 -->
	<select id="powerChk" resultType="java.lang.Integer">
		SELECT power FROM crawlerPowerCheck;
	</select>
	
	<!-- 상태 조회(0-2 & 최근 갱신 시간) -->
	<select id="statusList" resultType="statusVO">
		SELECT * FROM statusNews;
	</select>
	
	<!-- 크롤러 작동 시작/종료/걸린/평균시간 -->
	<select id="operateTime" resultType="operateTimeVO">
		SELECT * from operatingTime;
	</select>
	
	<!-- 크롤링 대상 기사 수 / 새 기사 / 지금까지 수집한 기사 수 -->
	<select id="searchNewsCnt" resultType="searchNewsVO">
		SELECT site,target,newData,allData FROM searchNews WHERE lastDataChk = 1;
	</select>
	
	<!-- 에러 로그 -->
	<select id="errLog" resultType="logVO" parameterType="java.lang.String">
		SELECT errTime,site,error FROM errLog WHERE errTime LIKE CONCAT(#{today},'%');
	</select>
	
	
	<!-- 크롤러 관리 페이지 history -->
	
	<!-- 새로 수집한 기사 -->
	<select id="searchNewsHistory" resultType="searchNewsHistoryVO" parameterType="java.lang.String">
		SELECT site,date_format(chkTime,'%H') hour,sum(newData) newDataSum FROM searchNews WHERE DATE(chkTime) = #{today} GROUP BY site,hour;
	</select>
	
	<!-- 에러율 -->
	<select id="errPerTry" resultType="errorRatioVO" parameterType="java.lang.String">
		SELECT site,success,error dt FROM errCnt WHERE dt = #{today};
	</select>
	
	
</mapper>